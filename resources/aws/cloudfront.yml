Resources:
  MoviesDistribution:
    Type: AWS::CloudFront::Distribution
    Properties:
      DistributionConfig:
        DefaultCacheBehavior:
          AllowedMethods:
            - GET
            - HEAD
            - OPTIONS
          ForwardedValues:
            Cookies:
              Forward: none
            Headers:
              - Access-Control-Request-Headers
              - Access-Control-Request-Method
              - Origin
            QueryString: 'false'
          LambdaFunctionAssociations:
            - EventType: viewer-request
              LambdaFunctionARN: AuthorizeUserLambdaFunction
          TargetOriginId:
            Ref: MoviesBucket
          ViewerProtocolPolicy: redirect-to-https
        Enabled: true
        Origins:
          - DomainName:
              Fn::Join:
                - ''
                - - Ref: MoviesBucket
                  - .s3.
                  - ${self:provider.region}
                  - .amazonaws.com
            Id:
              Ref: MoviesBucket
            S3OriginConfig:
              OriginAccessIdentity:
                Fn::Join:
                  - ''
                  - - origin-access-identity/cloudfront/
                    - Ref: MoviesBucketOriginAccessIdentity
        PriceClass: PriceClass_100
        ViewerCertificate:
          CloudFrontDefaultCertificate: true
